<html metal:use-macro="here/main_template/macros/master"
      i18n:domain="cpsforum">

<metal:block fill-slot="main">
<tal:block define="post_id request/post_id|nothing;
                   doc here/getContent|here;
                   threads doc/getThreads;
                   post python:doc[post_id];
                   replies python:post and doc.getPostReplies(post_id);
                   image doc/image|nothing;
                   description doc/description|nothing;
                   member python:here.portal_membership.getAuthenticatedMember();
                   is_poster python:member.has_permission('Forum Post', here);
                   is_reviewer python:member.has_permission('Forum Moderate', here);
                   can_post python:here.isAllowedToPost(is_poster=is_poster,
                                                        is_anon=isAnon,forum=doc)">

  <div class="documentActions" tal:condition="can_post">
    <a href="" i18n:translate=""
       tal:attributes="href string:${context_url}/forum_post_form">
      forum_new_thread
    </a>
  </div>

  <h1 tal:content="doc/title">Title</h1>

  <br />
  <table class="forumPost" cellspacing="0" cellpadding="0">
    <tal:block condition="post_id"
               replace="structure python:here.post_view_snippet(
                                                  post_id=post_id,
                                                  forum=doc,
                                                  is_reviewer=is_reviewer,
                                                  can_post=can_post,
                                                  comment_mode=0)"/>
    <tr><td colspan="2">&nbsp;</td></tr>
  </table>
  <div class="group">
    <table class="forumThreads" cellspacing="0" cellpadding="0">
      <tal:block condition="python:len(threads)">
        <tr><td colspan="2">
          <tal:block replace="structure python:here.forum_view_threads(
                                                  post_id=post_id,
                                                  is_reviewer=is_reviewer)"/>
        </td></tr>
      </tal:block>
      <tr tal:condition="python:not len(threads)">
        <td i18n:translate="forum_no_message" class="forumempty">
          Aucun message dans ce forum !
        </td>
      </tr>
    </table>
  </div>

</tal:block>

</metal:block>

</html>
