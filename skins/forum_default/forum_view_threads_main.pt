<tal:block tal:define="post_id options/post_id;
                       descendants options/descendants;
                       is_reviewer options/is_reviewer;
                       forum nocall:options/forum;
                       threads_per_page python:forum.threads_per_page">
  <form method="post" tal:attributes="action here/absolute_url" name="post_form">
  <table border="0" style='width:100%;height:inherit'
           cellspacing='0' cellpadding='0'>
    <tal:block tal:condition="threads_per_page">
    <tal:block tal:define="batch_start python:int(path('request/frm_start | nothing') or 0);
                           batched_desc python:modules['ZTUtils'].Batch(descendants,
                                                                   size=threads_per_page,
                                                                   start=batch_start)">
      <input type="hidden" name="frm_start" 
             tal:attributes="value batch_start" />
      <tr tal:define="mq nocall:modules/ZTUtils/make_query;
                      previous_page python:batched_desc.previous;
                      next_page python:batched_desc.next">
        <td colspan="6" class="forumThreadBatch">
          <a href="." tal:condition="previous_page"
             tal:attributes="href python:'%s?%s'%(request['URL'],
                                                  mq(request.form,
                                                     frm_start=0))">«</a>
          <a href="." tal:condition="previous_page"
             tal:attributes="href python:'%s?%s'%(request['URL'],
                                    mq(request.form, frm_start=previous_page.first))"
             i18n:translate="">
            forum_link_prev_threads <span i18n:name="tpp" tal:content="threads_per_page"/>
          </a>
          <a href="." tal:condition="next_page"
             tal:attributes="href python:'%s?%s'%(request['URL'],
                                    mq(request.form, frm_start=next_page.first))"
             i18n:translate="">
            forum_link_next_threads <span i18n:name="tpp" tal:content="threads_per_page"/>
          </a>
          <a href="." tal:condition="next_page"
             tal:attributes="href python:'%s?%s'%(request['URL'],
                                                  mq(request.form,
                                                     frm_start=(len(descendants) - threads_per_page + (len(descendants) % threads_per_page))))">»</a>
        </td>
      </tr>
      <tr>
        <td class="forumSelectCell">
          <input type="hidden" name="parent_id:string" 
                 tal:attributes="value post_id" />
        </td>
        <td class="forumModerateCell">&nbsp;</td>
        <th class="forumSubjectCell" i18n:translate="forum_subject">Subject</th>
        <th class="forumAuthorCell"
            i18n:translate="forum_author">Author</th>
        <th class="forumDateCell"
            i18n:translate="forum_date">Date</th>
        <td class="forumLockCell"></td>
      </tr>
      <tal:span tal:content="structure python:here.post_tree(descendants=batched_desc, 
                                                             post_id=post_id,
                                                             frm_start=batch_start)"/>
    </tal:block>
    </tal:block>
    <tal:block tal:condition="not: threads_per_page">
      <tr>
        <td class="forumSelectCell">
          <input type="hidden" name="parent_id:string" 
                 tal:attributes="value post_id" />
        </td>
        <td class="forumModerateCell">&nbsp;</td>
        <th class="forumSubjectCell" i18n:translate="forum_subject">Subject</th>
        <th class="forumAuthorCell"
            i18n:translate="forum_author">Author</th>
        <th class="forumDateCell"
            i18n:translate="forum_date">Date</th>
        <td class="forumLockCell"></td>
      </tr>
      <tal:span tal:content="structure python:here.post_tree(descendants=descendants, 
                                                             post_id=post_id)"/>
    </tal:block>
  </table>
  <div class="forumModeration">
    <tal:block condition="python:is_reviewer">
      <input type="submit" name="forum_publish_posts:method"
             class="context" value="forum_publish" 
             i18n:attributes="value" />
      <input type="submit" name="forum_unpublish_posts:method"
             class="context" value="forum_depublish" 
             i18n:attributes="value" />
    </tal:block>
    <tal:block condition="python:is_reviewer">
      <input type="submit" name="forum_lock_thread:method"
             class="context" value="forum_button_lockunlock" 
             i18n:attributes="value" />
    </tal:block>
    <tal:block condition="python:is_reviewer">
      <input type="submit" name="forum_del_posts:method"
             class="destructive" value="forum_delete"
             tal:define="cpsmcat nocall:here/Localizer/default"
             tal:attributes="onclick python:'return window.confirm(\'%s\')' %
                               (cpsmcat('description_confirm_delete'), )"
             i18n:attributes="value" />
    </tal:block>
  </div>
  </form>
</tal:block>
